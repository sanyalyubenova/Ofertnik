<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ç–∞—Ä–∏—Ñ–∏</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin.css">
</head>
<body class="admin-page">
    <div class="container admin-container">
        <header>
            <h1>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</h1>
            <p class="subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ç–∞—Ä–∏—Ñ–∏</p>
            <div style="display: flex; gap: 15px; align-items: center;">
                <a href="/" class="back-link">‚Üê –û–±—Ä–∞—Ç–Ω–æ –∫—ä–º –∫–∞–ª–∫—É–ª–∞—Ç–æ—Ä–∞</a>
                <a href="/admin-users" class="back-link" id="admin-users-link" style="display: none;">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</a>
                <span id="username-display" style="color: #fff; font-size: 0.7rem;"></span>
                <a href="#" onclick="event.preventDefault(); logout();" class="back-link">–ò–∑—Ö–æ–¥</a>
            </div>
        </header>

        <main class="admin-main-content">
            <!-- Insurer and Insurance Type Selection -->
            <div class="card admin-selector-card">
                <h4>–¢–∞—Ä–∏—Ñ–∞</h4>
                <div class="selector-column">
                    <div class="form-group">
                        <label>–ó–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª:</label>
                        <div class="option-buttons" id="insurer-buttons">
                            <button type="button" class="option-btn" data-value="generali">–î–∂–µ–Ω–µ—Ä–∞–ª–∏</button>
                            <button type="button" class="option-btn" data-value="armeec">–ê—Ä–º–µ–µ—Ü</button>
                            <button type="button" class="option-btn" data-value="bulstrad">–ë—É–ª—Å—Ç—Ä–∞–¥</button>
                            <button type="button" class="option-btn" data-value="dzi">–î–ó–ò</button>
                            <button type="button" class="option-btn" data-value="bul-ins">–ë—É–ª –ò–Ω—Å</button>
                        </div>
                    </div>
                    
                    <div class="form-group" id="insurance-type-group">
                        <label>–ó–∞—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞:</label>
                        <div class="option-buttons" id="insurance-type-buttons">
                            <button type="button" class="option-btn" data-value="casco">–ö–∞—Å–∫–æ</button>
                            <button type="button" class="option-btn" data-value="mtpl">–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∞ –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç</button>
                            <button type="button" class="option-btn" data-value="gap" id="gap-option-btn">GAP</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="card tabs-container">
                <h3 id="tariff-edit-title" class="tariff-edit-title">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–∞—Ä–∏—Ñ–∞ –∑–∞ <span id="insurance-type-name"></span> –Ω–∞ <span id="insurer-name"></span></h3>
                <div class="tabs">
                    <button class="tab-btn active" data-tab="tariffs">–û—Å–Ω–æ–≤–Ω–∏ —Ç–∞—Ä–∏—Ñ–∏</button>
                    <button class="tab-btn" data-tab="discounts">–û—Ç—Å—Ç—ä–ø–∫–∏</button>
                    <button class="tab-btn" data-tab="surcharges">–ù–∞–¥–±–∞–≤–∫–∏</button>
                </div>

                <!-- Tab Content: –û—Å–Ω–æ–≤–Ω–∏ —Ç–∞—Ä–∏—Ñ–∏ -->
                <div class="tab-content active" id="tariffs-tab">
                    <!-- <div class="tab-header">
                        <h3>–û—Å–Ω–æ–≤–Ω–∏ —Ç–∞—Ä–∏—Ñ–Ω–∏ —á–∏—Å–ª–∞</h3>
                    </div> -->
                    <!-- CASCO: –¢–∞–±–ª–∏—Ü–∞ –∑–∞ –≤—ä–∑—Ä–∞—Å—Ç –Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–∞ –∏ –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª–Ω–∞ —Å—É–º–∞ -->
                    <div id="casco-tariffs-section" class="tariff-section">
                        <div class="table-container">
                            <div class="table-scroll-wrapper">
                                <table class="data-table" id="tariffs-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 60px;"></th>
                                            <th>–í—ä–∑—Ä–∞—Å—Ç –Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–∞ (–æ—Ç)</th>
                                            <th>–í—ä–∑—Ä–∞—Å—Ç –Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–∞ (–¥–æ)</th>
                                            <th>–ó–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª–Ω–∞ —Å—É–º–∞ –æ—Ç (‚Ç¨)</th>
                                            <th>–ó–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª–Ω–∞ —Å—É–º–∞ –¥–æ (‚Ç¨)</th>
                                            <th>–¢–∞—Ä–∏—Ñ–µ–Ω –ø—Ä–æ—Ü–µ–Ω—Ç (%)</th>
                                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tariffs-tbody">
                                        <!-- Rows will be added dynamically -->
                                    </tbody>
                                </table>
                            </div>
                            <button class="btn btn-add" id="add-tariff-row">+ –î–æ–±–∞–≤–∏ —Ä–µ–¥</button>
                        </div>
                    </div>
                    
                    <!-- MTPL: –¢–∞–±–ª–∏—Ü–∞ —Å –±–∞–∑–æ–≤–∏ –ø—Ä–µ–º–∏–∏ –ø–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –æ—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏ -->
                    <div id="mtpl-tariffs-section" class="tariff-section" style="display: none;">
                        <div class="table-container">
                            <div class="table-scroll-wrapper">
                                <table class="data-table" id="mtpl-tariffs-table">
                                    <thead id="mtpl-tariffs-thead">
                                        <!-- Headers will be added dynamically based on insurer -->
                                    </thead>
                                    <tbody id="mtpl-tariffs-tbody">
                                        <!-- Rows will be added dynamically -->
                                    </tbody>
                                </table>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-add" id="add-mtpl-tariff-row">+ –î–æ–±–∞–≤–∏ —Ä–µ–¥</button>
                                <button class="btn btn-add" id="copy-last-mtpl-row" style="background: #17a2b8;">üìã –ö–æ–ø–∏—Ä–∞–π –ø–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–¥</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: –û—Ç—Å—Ç—ä–ø–∫–∏ -->
                <div class="tab-content" id="discounts-tab">
                    <!-- <div class="tab-header">
                        <h3>–û—Ç—Å—Ç—ä–ø–∫–∏</h3>
                    </div> -->
                    <div class="table-container">
                        <div class="table-scroll-wrapper">
                            <table class="data-table" id="discounts-table">
                                <thead>
                                    <tr>
                                        <th style="width: 60px;"></th>
                                        <th>–¢–∏–ø –æ—Ç—Å—Ç—ä–ø–∫–∞</th>
                                        <th>–°—Ç–æ–π–Ω–æ—Å—Ç (%)</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="discounts-tbody">
                                    <!-- Rows will be added dynamically -->
                                </tbody>
                            </table>
                        </div>
                        <button class="btn btn-add" id="add-discount-row">+ –î–æ–±–∞–≤–∏ —Ä–µ–¥</button>
                    </div>
                </div>

                <!-- Tab Content: –ù–∞–¥–±–∞–≤–∫–∏ -->
                <div class="tab-content" id="surcharges-tab">
                    <!-- <div class="tab-header">
                        <h3>–ù–∞–¥–±–∞–≤–∫–∏</h3>
                    </div> -->
                    <div class="table-container">
                        <div class="table-scroll-wrapper">
                            <table class="data-table" id="surcharges-table">
                                <thead>
                                    <tr>
                                        <th style="width: 60px;"></th>
                                        <th>–¢–∏–ø –Ω–∞–¥–±–∞–≤–∫–∞</th>
                                        <th>–£—Å–ª–æ–≤–∏–µ</th>
                                        <th>–°—Ç–æ–π–Ω–æ—Å—Ç (%)</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="surcharges-tbody">
                                    <!-- Rows will be added dynamically -->
                                </tbody>
                            </table>
                        </div>
                        <button class="btn btn-add" id="add-surcharge-row">+ –î–æ–±–∞–≤–∏ —Ä–µ–¥</button>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–µ–Ω –ø–∞–Ω–µ–ª - –û—Ñ–µ—Ä—Ç–Ω–∏–∫</p>
        </footer>
    </div>

    <script src="admin.js"></script>
    <script>
        // Check user role and show/hide admin users link, also display username
        async function checkUserRole() {
            try {
                const response = await fetch('/api/me');
                if (response.ok) {
                    const user = await response.json();
                    // Display username
                    const usernameDisplay = document.getElementById('username-display');
                    if (usernameDisplay && user.username) {
                        usernameDisplay.textContent = user.username;
                    }
                    // Show admin users link if admin
                    if (user.role === 'admin') {
                        document.getElementById('admin-users-link').style.display = 'block';
                    }
                }
            } catch (error) {
                console.error('Error checking user role:', error);
            }
        }
        
        // Check role on page load
        checkUserRole();
        
        async function logout() {
            try {
                await fetch('/api/logout', { method: 'POST' });
                window.location.href = '/login';
            } catch (error) {
                console.error('Error logging out:', error);
                window.location.href = '/login';
            }
        }
    </script>
</body>
</html>

